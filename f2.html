<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Find Tan (Plus 3 Cells to the Left)</title>
  <!-- Tailwind (For quick styling). For production, consider bundling locally -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
  <h1 class="text-2xl font-bold mb-4">Find "Tan" + 3 Cells to the Left</h1>
  <div id="results" class="w-full max-w-xl flex flex-col gap-4"></div>

  <script>
    // ===============================
    // Step 1: Configure your sheet info
    // ===============================
    const apiKey = "AIzaSyBsdyMrJW3RmU7hyYoHh6EpoC_cynXs_7c"; 
    const sheetId = "1BsGqMhxwTGWzycOJmiKgmkDRN2Sb6QOyODCpjiVUDVo";
    // Update the range if your tab is named something else:
    const range = "ONSITE - CAFETERIA (A)!A1:J1000"; 
    // e.g. "ONSITE - CAFETERIA (A)!A1:Z1000" if that’s your sheet tab name.

    // The Google Sheets API endpoint for array-of-arrays:
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(range)}?key=${apiKey}`;

    // ===============================
    // Step 2: Fetch and parse
    // ===============================
    async function fetchSheetData() {
      try {
        const res = await fetch(url);
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        const data = await res.json();
        const rows = data.values; // <--- array of arrays
        if (!rows || !Array.isArray(rows)) {
          throw new Error("Sheet data not returned as an array of arrays.");
        }
        if (rows.length === 0) {
          console.warn("No rows found in this sheet/range.");
        }

        // Skip the first row if it's headers. Or decide how to treat row[0].
        // We'll skip row[0] here if it's a header row.
        // If not, remove this line.
        const actualData = rows.slice(1);

        displayTanMatches(actualData);
      } catch (err) {
        console.error("Error fetching sheet data:", err);
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = `
          <div class="bg-red-100 text-red-700 p-4 rounded">
            Failed to load data: ${err.message}
          </div>
        `;
      }
    }

    // ===============================
    // Step 3: Find "Tan" and show 3 left cells
    // ===============================
    function displayTanMatches(allRows) {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = ""; // clear old results

      // For each row, we check each cell for "Tan"
      allRows.forEach((row, rowIndex) => {
        // row is like ["someval", "someval", "Tan", "another", ...]
        if (!row) return;

        // We’ll gather all matches in this row
        let rowFoundAny = false;

        for (let col = 0; col < row.length; col++) {
          const cellValue = row[col] || "";
          // Check for partial match "Tan"
          if (cellValue.includes("Yvette")) {
            rowFoundAny = true;

            // Grab up to 3 cells to the left
            const leftCells = [];
            for (let offset = 1; offset <= 3; offset++) {
              const leftCol = col - offset;
              if (leftCol >= 0) {
                leftCells.push(row[leftCol]);
              }
            }

            // Let's display the match
            const card = document.createElement("div");
            card.className = "bg-white p-4 rounded shadow";

            // Show each left cell
            const leftCellsStr = leftCells
              .reverse() // so it prints from leftmost to rightmost
              .map((val, i) => `<li>Cell ${col - (i+1)}: ${val}</li>`)
              .join("");

            card.innerHTML = `
              <h2 class="text-lg font-bold mb-2">
                Found "Tan" in Row ${rowIndex+2}, Column ${col+1}
              </h2>
              <p class="text-sm">
                <strong>Cell Value:</strong> ${cellValue}
              </p>
              <ul class="pl-4 list-disc mt-2">
                <li><strong>3 cells to the left</strong> (if exist):</li>
                ${leftCellsStr || "<li>None (out of bounds)</li>"}
              </ul>
            `;
            resultsDiv.appendChild(card);
          }
        }

        // If rowFoundAny stays false, we skip
      });
    }

    // ===============================
    // Let's go
    // ===============================
    fetchSheetData();

  </script>
</body>
</html>

