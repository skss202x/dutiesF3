<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tan's Data Page</title>
  <!-- âœ… TAILWIND FOR QUICK STYLING -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-100 flex flex-col items-center justify-start p-4">
  <h1 class="text-2xl font-bold mb-4">ON-SITE - CAFETERIA (A) Data</h1>
  <div id="cards" class="flex flex-col gap-4 w-full max-w-md"></div>

  <script>
    // We'll fetch data from your published Google Sheet.
    // This link pulls the entire sheet as an array of objects.
    // If you'd like to parse strictly by row index, we can switch to an array-of-arrays approach.
    //
    // Currently, it references a 2PACX link, which typically won't work with opensheet.vercel.app
    // unless it's recognized as a standard doc ID. We suspect that's causing the 400 error.

    // TEST CASES:
    // 1) If the sheet is accessible with a valid ID: The code loads, finds 'Tan' if it exists, and displays results.
    // 2) If the sheet URL is invalid or not published: We expect an error message in the console and a fallback message on-screen.
    // 3) If the sheet is empty: We expect no cards to display, but no crash.
    // 4) If the doc link is actually a 2PACX link (like a Google Docs link or share link) and not a GSheet ID:
    //    We expect a 400 (Bad Request) from opensheet.vercel.app, which is what's happening now.

    // PLEASE CONFIRM:
    // - Is '2PACX-1vQSM-lJx6...' truly your sheet's ID?
    // - If not, what is the correct doc ID from your actual Google Sheet URL?

    const sheetUrl = "https://opensheet.vercel.app/1BsGqMhxwTGWzycOJmiKgmkDRN2Sb6QOyODCpjiVUDVo/ONSITE%20-%20CAFETERIA%20(A)";

    async function fetchTanData() {
      try {
        const res = await fetch(sheetUrl);
        if (!res.ok) {
          // The sheet might be missing or not publicly published,
          // or the doc ID is invalid for opensheet.
          throw new Error(`Failed to load sheet. HTTP status ${res.status}`);
        }

        const rows = await res.json();
        if (!Array.isArray(rows) || rows.length === 0) {
          console.warn("Sheet is empty or not returned as an array.");
        }

        // We'll do a simple search:
        // 1) Find the row(s) that contain 'Tan' in *any* column.
        // 2) Then show that row. If the user wants EXACT 3-cells-to-the-left logic,
        //    we can clarify or use an array-of-arrays approach.

        const cardsDiv = document.getElementById('cards');

        // Ask the user: "What is the expected behavior if multiple rows have 'Tan'?" 
        // For now, we'll display them all.

        rows.forEach((rowObj) => {
          let foundTan = false;
          let foundKey = "";
          for (const key in rowObj) {
            if (rowObj[key] && rowObj[key].toString().includes("Yvette")) {
              foundTan = true;
              foundKey = key;
              break;
            }
          }

          if (!foundTan) return; // skip if Tan not found

          const dataStrings = Object.entries(rowObj)
            .map(([k, v]) => `${k}: ${v}`)
            .join("<br>");

          // Create a simple card
          const card = document.createElement('div');
          card.className = "bg-white p-4 rounded shadow";
          card.innerHTML = `
            <h2 class="text-lg font-bold mb-2">Found 'Tan' in column: ${foundKey}</h2>
            <p class="text-sm">${dataStrings}</p>
          `;
          cardsDiv.appendChild(card);
        });
      } catch (err) {
        console.error("Error fetching sheet:", err);
        // Provide a friendly message on-screen for the user.
        const cardsDiv = document.getElementById('cards');
        const errorEl = document.createElement('div');
        errorEl.className = "bg-red-100 text-red-700 p-4 rounded";
        errorEl.textContent = 
          "Failed to load data. Please check if the sheet is published, " + 
          "the sheet ID is correct, and that opensheet.vercel.app can access it.";
        cardsDiv.appendChild(errorEl);
      }
    }

    // Always ask the user what the exact expected behavior is if there's ambiguity.
    // For instance, do we want partial or exact matches for 'Tan'? Are there columns we should ignore?

    fetchTanData();
  </script>
</body>
</html>
